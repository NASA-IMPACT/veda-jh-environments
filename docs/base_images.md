# Base Images

### Intro

All our base images descend from [pangeo images](https://github.com/pangeo-data/pangeo-docker-images) or 
[planetary computer images](https://github.com/microsoft/planetary-computer-containers/) (which themselves descend from `pangeo`).

They are located in this repository in the folder `./docker-images/base/` and are publicly available on AWS ECR. 
Each includes an `ONBUILD` command that makes it easier for scientists to create custom 
images (see [custom images](./adding_custom_images.md) for more info) without writing `Dockerfile` configuration commands

### Which Packages do the Base Images Include?

To answer this question:

0. Find the base image you want to inspect. Let's look at: `./docker-images/base/pangeo-notebook`:

    ```python
    $ head -n 1 Dockerfile

    FROM pangeo/pangeo-notebook:2023.04.15

    ```
This points to pangeo's Dockerhub profile and the `pangeo-notebook` image tagged with `2023.04.15`

1. If we want to know what default packages this image has installed we can find the corresponding folder of the same
name (`pangeo-notebook`) in their [Github repository](https://github.com/pangeo-data/pangeo-docker-images/tree/master/pangeo-notebook)

2. Looking at the `environment.yml` files shows which packages are installed:

    ```python
    $ head -n 12 environment.yml

    name: pangeo
    channels:
     - conda-forge
     - nodefaults
    dependencies:
     - adlfs
     - argopy
     - awscli
     - boto3
     - bottleneck
     - cartopy
     - cfgrib
    ```

3. Looking at the the `conda-linux-64.lock` file will show which exact versions and package versions (including dependencies of dependencies) are installed:

    ```python
    $ head -n 12 conda-linux-64.lock

    # Generated by conda-lock.
    # platform: linux-64
    # input_hash: 02afee11ee9998eed91acd752c3640cf265b4f9674794125eb5af3047fb2e2e5
    @EXPLICIT
    https://conda.anaconda.org/conda-forge/linux-64/_libgcc_mutex-0.1-conda_forge.tar.bz2#d7c89558ba9fa0495403155b64376d81
    https://conda.anaconda.org/conda-forge/linux-64/ca-certificates-2022.12.7-ha878542_0.conda#ff9f73d45c4a07d6f424495288a26080
    https://conda.anaconda.org/conda-forge/noarch/font-ttf-dejavu-sans-mono-2.37-hab24e00_0.tar.bz2#0c96522c6bdaed4b1566d11387caaf45
    https://conda.anaconda.org/conda-forge/noarch/font-ttf-inconsolata-3.000-h77eed37_0.tar.bz2#34893075a5c9e55cdafac56607368fc6
    https://conda.anaconda.org/conda-forge/noarch/font-ttf-source-code-pro-2.038-h77eed37_0.tar.bz2#4d59c254e01d9cde7957100457e2d5fb
    https://conda.anaconda.org/conda-forge/noarch/font-ttf-ubuntu-0.83-hab24e00_0.tar.bz2#19410c3df09dfb12d1206132a1d357c5
    https://conda.anaconda.org/conda-forge/linux-64/gh-2.25.1-ha8f183a_0.conda#d3ab4eec2e464e7295e19f61e46b4622
    https://conda.anaconda.org/conda-forge/linux-64/git-lfs-3.3.0-ha770c72_0.conda#bed72a66ece736ba7e7898a721738613
    ```

### The Base Image doesn't Include a Package I Need

1. If you don't see the package version you will need in your custom image then follow the how-to for [creating custom images](./adding_custom_images.md)

2. If you don't see a `base` image you want to work with then follow the how-to for adding a base image
